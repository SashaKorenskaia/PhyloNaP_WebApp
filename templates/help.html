<!-- BEGIN: Navigation Bar -->
{% extends "base.html" %}

{% block css %}
<style>
    /* Custom styles for help page using overall.css variables */
    .help-sidebar {
        background-color: var(--background-light, #E0E0E0);
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .help-sidebar .card-header {
        background-color: var(--background-light, #E0E0E0);
        color: var(--background-light, #E0E0E0);
        border-bottom: none;
        font-weight: 600;
    }

    .help-sidebar .list-group-item {
        border-color: #ddd;
        transition: all 0.3s ease;
    }

    .help-sidebar .list-group-item:hover,
    .help-sidebar .list-group-item.active {
        background-color: var(--bright-color, #7B1B38);
        color: var(--background-light, #E0E0E0);
        border-color: var(--bright-color, #7B1B38);
    }

    .section-header {
        color: var(--bright-color, #7B1B38);
        border-bottom-color: var(--bright-color, #7B1B38) !important;
        font-weight: 600;
    }

    .custom-alert {
        /* background-color: rgba(123, 27, 56, 0.1); */
        background-color: var(--background-light, #E0E0E0);
        border-left: 4px solid var(--background-dark, #3D3D3D);
        color: var(--background-dark, #3D3D3D);
    }

    .pipeline-step {
        background-color: var(--bright-color, #7B1B38) !important;
        border-color: var(--bright-color, #7B1B38) !important;
    }

    .pipeline-step:nth-child(2) .pipeline-icon {
        background-color: var(--background-dark, #3D3D3D) !important;
    }

    /* Simplified card styling */
    .simple-card {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .simple-card h6 {
        color: var(--background-dark, #3D3D3D);
        font-weight: 600;
        margin-bottom: 10px;
    }

    .highlight-box {
        background-color: rgba(224, 224, 224, 0.1);
        border: 1px solid var(--background-light, #E0E0E0);
        border-radius: 6px;
        padding: 15px;
    }

    .custom-badge {
        background-color: var(--bright-color, #7B1B38);
        color: var(--background-light, #E0E0E0);
    }

    .link-custom {
        color: var(--bright-color, #7B1B38);
        text-decoration: none;
    }

    .link-custom:hover {
        color: var(--background-dark, #3D3D3D);
        text-decoration: underline;
    }

    /* Remove card overhead for cleaner look */
    .clean-section {
        background-color: #f8f9fa;
        border-radius: 6px;
        padding: 20px;
        margin: 15px 0;
    }
</style>
{% endblock %}

{% block content %}

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-md-3">
            <div class="sticky-top" style="top: 20px;">
                <div class="card help-sidebar">
                    <div class="card-header">
                        <h5 class="mb-0">Help Topics</h5>
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="#overview" class="list-group-item list-group-item-action">Database Overview</a>
                        <a href="#phylogenetic-trees" class="list-group-item list-group-item-action">Phylogenetic
                            Trees</a>
                        <a href="#classification" class="list-group-item list-group-item-action">Enzyme
                            Classification</a>
                        <!-- <a href="#submission" class="list-group-item list-group-item-action">Data contribution</a> -->
                        <a href="#contact" class="list-group-item list-group-item-action">Contact & Legal</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9">
            <!-- Introduction -->
            <div class="mb-5">
                <div class="alert custom-alert">
                    <h5 class="mt-2"></h5>
                    <h5><i class="fa fa-info-circle"></i> Motivation</h5>
                    <p>Natural products are a major source of novel drugs, and with the rise of antibiotic resistance,
                        there is an urgent need
                        to discover new compounds. Genome mining enables the rapid identification of biosynthetic gene
                        clusters (BGCs)
                        responsible for natural product biosynthesis. Predicting the structures of the synthesized
                        compounds is key to guiding
                        their targeted discovery, but this requires detailed knowledge of the enzymatic reactions at
                        each step of the
                        biosynthetic pathway. While the core scaffold of many natural products can often be predicted
                        from the initial
                        biosynthetic steps, later tailoring modifications remain difficult to model due to the limited
                        characterization of the
                        enzymes involved. Reliable reaction prediction requires first gathering functional annotations
                        and performing
                        evolutionary analysis of these enzymes—only then can accurate computational predictions be made.
                        In the absence of
                        automated tools, this process becomes time-consuming. Although phylogenetic trees with
                        functional annotations are
                        occasionally published, reusing them directly is labor-intensive and technically challenging.
                    </p>
                    <p>PhyloNaP addresses this gap by providing a centralized collection of annotated phylogenetic trees
                        for enzymes involved
                        in natural product biosynthesis.</p>
                </div>
            </div>

            <!-- 1. Database Overview -->
            <section id="overview" class="mb-5">
                <h2 class="border-bottom pb-2 section-header">1. Database Content Overview</h2>

                <div class="row mb-4">
                    <div class="col-md-8">
                        <h4>What's in the Database</h4>
                        <p>PhyloNaP's database contains comprehensive phylogenetic datasets for protein families
                            involved
                            in natural product biosynthesis. Each dataset includes:</p>
                        <ul>
                            <li><strong>Phylogenetic tree</strong> with evolutionary model</li>
                            <li><strong>Sequence files</strong> in FASTA format</li>
                            <li><strong>Multiple sequence alignments</strong></li>
                            <li><strong>Annotation files</strong> with functional data</li>
                            <li><strong>Optional elements:</strong> descriptions, superfamily classifications, reaction
                                pathway images, and natural product structures</li>
                        </ul>
                    </div>
                </div>

                <h4>Database Composition</h4>
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="simple-card">
                            <h6><i class="fa fa-check-circle"></i> Curated Datasets (10)</h6>
                            <p class="small">High-quality, manually reviewed datasets from:</p>
                            <ul class="small">
                                <li>Supplementary data or metadata from published articles</li>
                                <li>Directly obtained from authors</li>
                                <li>Provided by collaborators</li>
                            </ul>
                            <!-- <p class="small"><strong>Features:</strong> Full citation information, manually curated
                                annotations</p> -->
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="simple-card">
                            <h6><i class="fa fa-cogs"></i> Automated Datasets (~18,500)</h6>
                            <p class="small">Computationally generated phylogenetic trees covering:</p>
                            <ul class="small">
                                <li>Broad enzyme family coverage</li>
                                <li>Standardized quality control</li>
                                <li>Consistent annotation pipeline</li>
                            </ul>
                            <!-- <p class="small"><strong>Features:</strong> Large-scale coverage, systematic processing,
                                regular updates</p> -->
                        </div>
                    </div>
                </div>



                <h4>Database Generation Pipeline</h4>
                <!-- <div class="row">
                    <div class="col-12">
                        <div class="text-center mb-3">
                            <img src="/static/images/help/pipeline_flow.png" class="img-fluid"
                                alt="Database Generation Pipeline" style="max-height: 400px;">
                            <p class="small text-muted mt-2">Comprehensive pipeline for automatic dataset generation</p>
                        </div>
                    </div>
                </div> -->

                <div class="clean-section">
                    <h5>Pipeline Steps</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <h6><strong>A) Data Collection</strong></h6>
                            <p class="small">Protein sequences and annotations gathered from multiple high-quality
                                databases:</p>
                            <ul class="small">
                                <li><strong>MiBIG:</strong> Characterized biosynthetic gene clusters</li>
                                <li><strong>MITE:</strong> Tailoring enzymes with experimentally proven reactions</li>
                                <li><strong>antiSMASH DB:</strong> Predicted biosynthetic gene clusters</li>
                                <li><strong>UniProt SwissProt:</strong> Curated protein annotations</li>
                            </ul>
                            <p class="small">Collected data includes taxonomic information, BGC types, functional
                                annotations, and structural data (SMILES) when available.</p>

                            <h6><strong>B) Sequence Clustering</strong></h6>
                            <p class="small">Sequences clustered using <code>mmseqs easy-linclust</code> with default
                                parameters (E-value: 1.000E-03) to group related proteins.</p>

                            <h6><strong>C) Quality Filtering</strong></h6>
                            <p class="small">Clusters are filtered to remove:</p>
                            <ul class="small">
                                <li>Explicitly eukaryotic proteins or SwissProt-only clusters</li>
                                <li>Small clusters (&lt;20 sequences)</li>
                                <li>Sequences with unusual lengths (&lt;150 or &gt;1000 amino acids)</li>
                                <li>NRPS/PKS sequences (require domain-level analysis)</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6><strong>D) Phylogenetic Analysis</strong></h6>
                            <ol class="small">
                                <li><strong>Alignment:</strong> Sequences aligned with <code>MAFFT auto</code></li>
                                <li><strong>Trimming:</strong> Alignments trimmed with <code>TrimAl auto</code></li>
                                <li><strong>Deduplication:</strong> Identical sequences removed (annotations preserved)
                                </li>
                                <li><strong>Tree construction:</strong> Phylogenetic trees built with
                                    <code>FastTree</code>
                                </li>
                                <li><strong>Rooting:</strong> Trees rooted using <code>MAD-root</code></li>
                            </ol>

                            <h6><strong>E) Functional Classification</strong></h6>
                            <p class="small">All sequences classified into superfamilies using <code>HMMER</code> with
                                superfamilies_1.75 profiles for consistent functional annotation.</p>

                            <div class="custom-alert alert mt-3">
                                <h6><i class="fa fa-info-circle"></i> Quality Assurance</h6>
                                <p class="small mb-0">Each step includes quality control measures to ensure reliable
                                    phylogenetic reconstructions and meaningful functional predictions.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <h4>Database Navigation</h4>
                <div class="highlight-box">
                    <p>Users can efficiently explore the database using multiple filtering and sorting options:</p>
                    <img src="{{ url_for('static', filename='pictures/database.png') }}"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    <div class="row">
                        <div class="col-md-6">
                            <ul>
                                <li><strong>HMM name:</strong> Focus on specific enzyme families</li>
                                <li><strong>Source</strong> Distinguishes manually generated and annotated datasers and
                                    those generated by PhyloNaP
                                    pipeline</li>
                                <li><strong>Data type</strong> The automatic pipeline include only full proteins, but we
                                    kept an option for long
                                    multidomain proteins to load the datasets on specific domains </li>

                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul>
                                <li><strong>N of sequences:</strong> The overall dataset size</li>
                                <li><strong>N of characterized:</strong> Number of proteins with known reaction
                                    (Proteins sourced from SwissProt+having
                                    Rhea number or from MITE)</li>
                                <li><strong>N of validated NP:</strong> Number of proteins from BGC, synthesizing
                                    characterized natural product (an
                                    entry from MiBiG)</li>
                                <li><strong>N of predicted NP:</strong> Number of proteins from predicted BGC
                                    (antiSMASHdb)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. Phylogenetic Trees -->
            <section id="phylogenetic-trees" class="mb-5">
                <h2 class="border-bottom pb-2 section-header">2. Examining Phylogenetic Tree Pages</h2>

                <div class="custom-alert alert mb-4">
                    <h5><i class="fa fa-tree"></i> Interactive Tree Visualization</h5>
                    <p>PhyloNaP provides powerful interactive tools for exploring phylogenetic relationships and
                        functional annotations. Each tree page combines evolutionary context with biochemical
                        information to facilitate enzyme function prediction.</p>
                </div>

                <h4>Explore the Tree</h4>
                <img src="{{ url_for('static', filename='pictures/tree.png') }}"
                    style="width: 100%; height: 100%; object-fit: cover;">
                <h4>Summary of the clade feature</h4>
                <p> When you click on a node and select "Get the summary of the clade", a metadata summary is displayed.
                    This summary shows all features associated with the selected node, and the descendant branches of
                    that node will be highlighted in color.</p>
                <p>By default, the features are sorted from those with the most identical values to those with the
                    greatest diversity.
                    However, users can adjust the sorting order manually using the arrow buttons.
                    :</p>
                <img src="{{ url_for('static', filename='pictures/metadata.png') }}"
                    style="width: 100%; height: 100%; object-fit: cover;">




            </section>

            <!-- 3. Enzyme Classification & Protein Placement -->
            <section id="classification" class="mb-5">
                <h2 class="border-bottom pb-2 section-header">3. Enzyme Classification & Protein Placement </h2>
                <h4>Protein Placement Pipeline Overview</h4>
                <div class="custom-alert alert mb-4">
                    <p>
                        PhyloNaP enables users to classify their protein sequences by placing them onto curated
                        phylogenetic
                        trees using a robust, multi-step computational pipeline.
                    </p>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="simple-card">
                            <h6><i class="fa fa-upload"></i> Input Format</h6>
                            <ul class="small">
                                <li>Submit one or multiple protein sequences in <strong>FASTA</strong> format.</li>
                            </ul>
                            <h6><i class="fa fa-search"></i> Similarity Search</h6>
                            <ul class="small">
                                <li>Each query is searched against a non-redundant PhyloNaP protein database using
                                    <strong>MMseqs2</strong>.
                                </li>
                                <li>The non-redundant set is built by aggregating all proteins and filtering out those
                                    with
                                    &gt;70%
                                    similarity.</li>
                                <li>Search thresholds:
                                    <ul>
                                        <li>&ge; 30% sequence identity</li>
                                        <li>&ge; 50% alignment coverage</li>
                                    </ul>
                                </li>
                            </ul>
                            <h6><i class="fa fa-random"></i> Placement Procedure</h6>
                            <ul class="small">
                                <li>For each query with hits, the associated dataset is retrieved.</li>
                                <li>The query is aligned to the reference multiple sequence alignment used for the tree.
                                </li>
                                <li>The combined alignment is submitted to <strong>EPA-ng</strong> for placement onto
                                    the
                                    existing
                                    phylogenetic tree.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="simple-card">
                            <h6><i class="fa fa-sitemap"></i> EPA-ng Placement Details</h6>
                            <ul class="small">
                                <li>EPA-ng uses the reference tree’s evolutionary model to generate a new tree from the
                                    extended
                                    alignment.</li>
                                <li>It compares the new topology with the original to determine the most likely
                                    placement(s).</li>
                                <li>Each placement includes:
                                    <ul>
                                        <li>Placement position (clade or node)</li>
                                        <li>Branch lengths</li>
                                        <li>Likelihood weight ratio (LWR, 0–1; sum of all LWRs is 1)</li>
                                    </ul>
                                </li>

                                <li>
                                    <strong>Note:</strong> A query may be placed in multiple locations, especially if it
                                    is
                                    distant
                                    from known clades or tree topology changes significantly, indicating higher
                                    uncertainty.
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="highlight-box mb-4">
                    <h6><i class="fa fa-exclamation-triangle"></i> Understanding Branch Length & Placement Quality</h6>
                    <p class="small mb-1">
                        Each placement features a <strong>pendant length</strong>—the branch connecting the query to the
                        placement
                        node/leaf.
                    </p>
                    <ul class="small mb-1">
                        <li>A long pendant length suggests greater evolutionary distance from the placement clade.</li>
                        <li>This may indicate the query is not well represented by the clade’s features; interpret with
                            caution.
                        </li>

                    </ul>
                </div>

                <div class="simple-card mb-4">
                    <h6><i class="fa fa-table"></i> Results Table</h6>
                    <img src="{{ url_for('static', filename='pictures/results.png') }}" class="img-fluid my-2"
                        alt="Results Table"
                        style="max-width: 900px; display: block; margin-left: auto; margin-right: auto;">
                    <ul class="small mt-2">
                        <li>Displays all matching datasets.</li>
                        <li>Shows the Likelihood weight ratio of the best placement for each.</li>
                        <li>If a query matches multiple trees, only the placement with the shortest pendant length
                            is shown by default.</li>
                        <li>You can toggle to display all alternative placements.</li>
                        <li>Datasets are <span style="color:#7B1B38;font-weight:600;">highlighted in red</span> when the
                            best
                            placement has a pendant length &gt; 1.</li>
                    </ul>
                </div>
                <div class="simple-card">
                    <h6><i class="fa fa-tree"></i> Tree Visualization</h6>
                    <img src="{{ url_for('static', filename='pictures/placement.png') }}" alt="Tree Placement"
                        class="img-fluid my-2"
                        style="max-width: 900px; display: block; margin-left: auto; margin-right: auto;">
                    <ul class="small mt-2">
                        <li>Placements are shown as <span style="color:#7B1B38;font-weight:600;">red circles</span>
                            on the phylogenetic tree.</li>
                        <li>Circle size reflects the relative likelihood of each placement.</li>
                        <li>If there is one dominant placement, only that is shown by default; others can be
                            revealed by clicking “Show all placements”.</li>
                    </ul>
                </div>
            </section>
        </div>
    </div>


</div>
<section id="contact" class="mb-5">
    <h2 class="border-bottom pb-2 section-header">Contact and legal</h2>
    <h4 class="mt-4">Contact</h4>
    <div class="px-2 py-3" style="background: #f8f9fa; border-radius: 6px; max-width: 600px;">
        <p class="mb-2">
            <strong>Mail:</strong>
            For any questions or feedback, please contact us at
            <a href="mailto:aleksandra.korenskaiai@uni-tuebingen.de" class="link-custom">
                aleksandra.korenskaiai@uni-tuebingen.de
            </a>
        </p>
        <p class="mb-0">
            Ziemert Lab, University of Tübingen, Germany
        </p>
    </div>
    <h4 class="mt-4">Legal</h4>
    <div class="simple-card">
        <h5><i class="fa fa-shield"></i> Data Usage & Privacy</h5>
        <p><strong>License:</strong></p>
        <p>PhyloNaP is released under the <a href="https://opensource.org/licenses/MIT" target="_blank"
                class="link-custom">MIT License</a>. The software is free to use for
            academic and commercial purposes.</p>

        <p><strong>Data Privacy:</strong></p>
        <ul>
            <li>Submitted sequences are processed temporarily</li>
            <li>No sequences are permanently stored</li>
            <li>Job results are kept for 30 days</li>
            <li>No personal data is collected beyond optional email</li>
        </ul>

        <p><strong>Cookies:</strong></p>
        <p>This site uses minimal functional cookies to maintain session state. No tracking or
            analytics cookies are used.</p>
    </div>
</section>
<!-- Smooth scrolling for navigation -->
<script>
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            document.querySelector(this.getAttribute('href')).scrollIntoView({
                behavior: 'smooth'
            });
        });
    });

    // Update active navigation item based on scroll position
    window.addEventListener('scroll', function () {
        let scrollPosition = window.scrollY;

        document.querySelectorAll('section[id]').forEach(section => {
            let sectionTop = section.offsetTop - 100;
            let sectionHeight = section.offsetHeight;
            let sectionId = section.getAttribute('id');

            if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
                document.querySelectorAll('.list-group-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`a[href="#${sectionId}"]`).classList.add('active');
            }
        });
    });
</script>
<hr class="my-4">

{% endblock %}